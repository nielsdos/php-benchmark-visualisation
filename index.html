<!doctype html>
<html>
	<head>
		<title>Performance graphs</title>
		<meta charset="utf-8">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            window.onload = async _ => {
                const rawData = await fetch('data.json').then(r => r.json());

                const labels = [];

                const data = {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Zend/bench.php',
                            data: [],
                            borderColor: "#7476ad",
                        },
                        {
                            label: 'Symfony Demo',
                            data: [],
                            borderColor: "black",
                        }
                    ]
                };

                // Reformat date
                for (const entry of rawData) {
                    const str = entry.commit_info.date.date.replace(' ', 'T') + entry.commit_info.date.timezone;
                    //console.log(str);
                    entry.commit_info.date = new Date(str);
                }

                // Sort by date
                rawData.sort((a, b) => {
                    return a.commit_info.date - b.commit_info.date;
                });

                const summaryToDataSetMapper = {
                    "bench.php": 0,
                    "symfony_demo": 1,
                };

                for (const entry of rawData) {
                    Object.keys(summaryToDataSetMapper).forEach(name => {
                        const id = summaryToDataSetMapper[name];
                        if (entry.summary[name])
                            data.datasets[id].data.push(entry.summary[name].instructions);
                        else
                            data.datasets[id].data.push(null);
                    });
                    labels.push(entry.commit_info.date.toLocaleString());
                }

                const config = {
                    type: 'line',
                    data,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'PHP performance'
                            }
                        }
                    },
                };
                new Chart(document.getElementById("chart").getContext("2d"), config);
            };
        </script>
        <style>
            .chart-container {
                width: 80%;
            }
        </style>
	</head>
	<body>
        <div class="chart-container"><canvas id="chart"></canvas></div>
	</body>
</html>